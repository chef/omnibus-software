--- a/src/config.h
+++ b/src/config.h
@@ -1,6 +1,16 @@
 /*
  * Copyright (c) 2009-2012, Redis Ltd.
  * All rights reserved.
  */
+
+/* Patch for SLES 12 compatibility:
+ * - Safely check for __has_attribute.
+ * - Never use (BSD >= ...) without defined(BSD).
+ */
+
+#ifndef __has_attribute
+#define __has_attribute(x) 0
+#endif
+

 /* ... (copyright and includes unchanged) ... */

@@ -210,7 +220,11 @@
 #include <sys/types.h> /* This will likely define BYTE_ORDER */
 
 #ifndef BYTE_ORDER
-#if (BSD >= 199103)
+#if defined(BSD) && (BSD >= 199103)
 #include <machine/endian.h>
 #else
 #if defined(linux) || defined(__linux__)
 #include <endian.h>
+
@@ -355,7 +369,11 @@
 /* Check if we can compile x86 SIMD code */
-#if defined(__x86_64__) && ((defined(__GNUC__) && __GNUC__ >= 5) || (defined(__clang__) && __clang_major__ >= 4)) && defined(__has_attribute) && __has_attribute(target)
+#if defined(__x86_64__) && ((defined(__GNUC__) && __GNUC__ >= 5) || (defined(__clang__) && __clang_major__ >= 4)) && __has_attribute(target)
 #define HAVE_X86_SIMD 1
 #else
 #define HAVE_X86_SIMD 0
 #endif
