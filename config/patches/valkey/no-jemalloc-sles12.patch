--- src/Makefile.org	2025-12-01 12:14:56
+++ src/Makefile	2025-12-01 12:22:46
@@ -73,7 +73,7 @@
 # Default allocator defaults to Jemalloc on Linux and libc otherwise
 MALLOC=libc
 ifeq ($(uname_S),Linux)
-	MALLOC=jemalloc
+	MALLOC ?= jemalloc
 endif
 
 # To get ARM stack traces if Valkey crashes we need a special C flag.
@@ -291,8 +291,13 @@
 
 ifeq ($(MALLOC),jemalloc)
 	DEPENDENCY_TARGETS+= jemalloc
-	FINAL_CFLAGS+= -DUSE_JEMALLOC -I../deps/jemalloc/include
-	FINAL_LIBS := ../deps/jemalloc/lib/libjemalloc.a $(FINAL_LIBS)
+        ifeq ($(MALLOC),jemalloc)
+		FINAL_CFLAGS+= -DUSE_JEMALLOC -I../deps/jemalloc/include
+        	DEPENDENCY_TARGETS+= jemalloc
+		FINAL_LIBS := ../deps/jemalloc/lib/libjemalloc.a $(FINAL_LIBS)
+        else
+        	FINAL_CFLAGS+= -DMALLOC=libc
+        endif
 endif
 
 ifeq ($(USE_LTTNG),yes)
